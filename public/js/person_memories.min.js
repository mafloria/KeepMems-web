/*
 * Keep Memories 
 *
 * Copyright (c) 2016 Spectacklebear
 * Date: Feb-05-2016
 * Author: Margaret Florian (mafloria) 
**/

jQuery(document).ready(function(){
	 
	 //open/close de form
	$("#link-add-person-memory").click(function(){
   		$("#new-person-memory-section").toggle();
	}); 
	
	$(".buddy-memory-row").click(function(){
	 	var id = $(this).attr('id');        
        var id_array = id.split("_");
        
        $(".buddy-memory-detail").hide();
        $("#buddy-memory-detail-"+id_array[1]).show();
                
	});
	
	//display memory details
	$(".link-display-mem-resume").click(function(){
		var id = $(this).attr('id');        
        var id_array = id.split("_");
        
        $("#show-memory-resume_"+id_array[1]).toggle();
        
	});
	
	// Counts and display the number of chars in the field        
    $("#memory-title").keyup(function(){          
        count_chars($(this), "memory-title-charcounter", 30);//inputfield, div_char_counter, max_chars                      
    });
    $("#memory-desc").keyup(function(){          
        count_chars($(this), "memory-desc-charcounter", 140);//inputfield, div_char_counter, max_chars                      
    });
    

	$("#new-person-memory-form").validate({		  
          ignore: 'hidden',
          errorPlacement: function(error, element) {          		          	
                if (element.attr("name") == "memory_feeling") {                  	                 	
                    error.insertAfter($(".estado-recuerdo"));                                        
                }else if(element.attr("name") == "memory_date"){
                	error.insertAfter($("#memory-date-display"));
                }else{
                    error.insertAfter(element);
                }
          },
	 	  submitHandler: function(form, event) { //Send signup data
	 	  	event.preventDefault();	 	  	
		    $.ajax({		    	
	            url: callurl+"webservices/add-memory/"+validation,
	            type: "POST",
	            data: $("#new-person-memory-form").serialize(),
	            dataType: "json",
	            success: 
	            	function(json_response){	            			            			            			            
	            		switch(json_response.code){
	            			case 201: 
	            				window.location=appurl+"person-memories/"+validation+"/"+json_response.new_memory_id;
	            			default: alert("error");	            				 	            			
	            		}	                	
	               	}//end function	                    				
			});//end ajax
		  }//end submithandler
	 });//end validate	 
  
	//date for new person memory
	$("#datepicker").datepicker({
		buttonText: "Choose",		
		minDate: new Date(), 
		defaultDate: new Date(), 
		dateFormat: "M dd, yy", 
		firstDay: 7, 		
		onClose:function(dateText, inst){
			var selected_date_display = $.datepicker.formatDate( "DD, MM d, yy", $('#datepicker').datepicker('getDate'));
			var selected_date_store = $.datepicker.formatDate( "dd-mm-yy", $('#datepicker').datepicker('getDate'));
			$("#memory-date").val(selected_date_store); 
			$("#memory-date-display").html(selected_date_display);			
			if(selected_date_display!="") { $("#hidden-memory-feeling").removeClass("error"); $("#memory-date-error").hide();}
		}          	  	
 	});
 	
 	//feeling picker
 	$(".memory-feeling").click(function(){
 		var id = $(this).attr('id');
 		$("#hidden-memory-feeling").val(id);
 		$("#hidden-memory-feeling").removeClass("error");
 		$("#hidden-memory-feeling-error").hide();
 	});
 
});//end document ready