/*
 * Keep Memories 
 *
 * Copyright (c) 2016 Spectacklebear
 * Date: Feb-05-2016
 * Author: Margaret Florian (mafloria) 
**/

jQuery(document).ready(function(){
	 
   /**
	* SIGNUP 	  
	*/
	 //signup link option
	 $("#signup-link").click(function(){
	 	$("#singup-div-form").show();
	 	$("#singin-div-form").hide();
		$("#signin-link").removeClass('active');
	 	$(this).addClass('active');
	 });
	 //validates signup form
	 $('#mem-user-signup-step1-form').validate({
	 	  submitHandler: function(form, event) { //Send signup data
	 	  	event.preventDefault();	 	  	
		    $.ajax({
	            url: callurl+"webservices/send-validation-email",
	            type: "POST",
	            data: $("#mem-user-signup-step1-form").serialize(),
	            dataType: "json",
	            success: 
	            	function(json_response){	            			            			            			            
	            		switch(json_response.code){
	            			case 201: 
	            				$("#mem-user-signup-step1-form").hide();	            					            				
	            				$("#after-registration-message").html(json_response.message);
	            				break; 
	            			case 202: 
	            				$("#singup-div-form").hide();
	            				$("#singin-div-form").show();	         
	            				$("#signup-link").removeClass('active');
	 							$("#signin-link").addClass('active');				
	            				$("#login-section-messages").html(json_response.message);//display message about email already exist
	            				$("#login-user-email").val($("#signup-user-email").val());
	            				$("#signup-user-email").val("");
	            				break;	            					            				
	            		}	                	
	               	}//end function	                    				
			});//end ajax
		  }//end submithandler
	 });//end validate
	 
	 //validates signup form
	 $('#mem-user-signup-form').validate({
	 	  submitHandler: function(form, event) { //Send signup data
	 	  	event.preventDefault();	 	  	
		    $.ajax({
	            url: callurl+"webservices/create-account",
	            type: "POST",
	            data: $("#mem-user-signup-form").serialize(),
	            dataType: "json",
	            success: 
	            	function(json_response){	            			            			            			            
	            		switch(json_response.code){
	            			case 201: 
	            				$("#singup-div-form").hide();
	            				$("#signup-messages").html(json_response.message);//display message about the email 
	            			case 202: 
	            				$("#singup-div-form").hide();
	            				$("#singin-div-form").show();	         
	            				$("#signup-link").removeClass('active');
	 							$("#signin-link").addClass('active');				
	            				$("#login-section-messages").html(json_response.message);//display message about email already exist
	            				$("#login-user-email").val($("#signup-user-email").val());
	            				$("#signup-user-email").val("");	            					            				
	            		}	                	
	               	}//end function	                    				
			});//end ajax
		  }//end submithandler
	 });//end validate

	
  	
	/**
	 * SIGNIN 	  
	 */
	//validates signin form
	 $("#signin-link").click(function(){
	 	$("#singin-div-form").show();
	 	$("#singup-div-form").hide();
	 	$("#signup-link").removeClass('active');
	 	$(this).addClass('active');
	 });	 	 
	 //validates signin form
	 $('#mem-user-signin-form').validate({
	 	submitHandler: function(form, event) { //Send signup data
	 	  	event.preventDefault();	 	  	
		    $.ajax({
	            url: callurl+"webservices/validate-token",
	            type: "POST",
	            data: $("#mem-user-signin-form").serialize(),
	            dataType: "json",
	            success: 
	            	function(json_response){	            			            			            			            
	            		switch(json_response.code){
	            			case 200: 
	            				window.location=appurl+"dashboard/"+json_response.session_id;	            					            				
	            			case 400: 	            				
	            				$("#singin-div-form").show();
	            				$("#login-section-messages").html(json_response.message);//display message about wrong login data
	            		}	                	
	               	}//end function	                    				
			});//end ajax
		  }//end submithandler
	 });	 	
 
});//end document ready