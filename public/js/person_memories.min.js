/*
 * Keep Memories 
 *
 * Copyright (c) 2016 Spectacklebear
 * Date: Feb-05-2016
 * Author: Margaret Florian (mafloria) 
**/

jQuery(document).ready(function(){
	 
	 //open/close de form
	$("#link-add-person-memory").click(function(){
   		$("#new-person-memory-section").toggle();
	}); 
	
	$(".buddy-memory-row").click(function(){
	 	var id = $(this).attr('id');        
        var id_array = id.split("_");
        
        $(".buddy-memory-detail").hide();
        $("#buddy-memory-detail-"+id_array[1]).show();
                
	});
	
	//display memory details
	$(".link-display-mem-resume").click(function(){
		var id = $(this).attr('id');        
        var id_array = id.split("_");
        
        $("#show-memory-resume_"+id_array[1]).toggle();
        
	});
	
	// Counts and display the number of chars in the field        
    $("#memory-title").keyup(function(){          
        count_chars($(this), "memory-title-charcounter", 30);//inputfield, div_char_counter, max_chars                      
    });
    $("#memory-desc").keyup(function(){          
        count_chars($(this), "memory-desc-charcounter", 140);//inputfield, div_char_counter, max_chars                      
    });
    

	$("#new-person-memory-form").validate({
	 	  submitHandler: function(form, event) { //Send signup data
	 	  	event.preventDefault();	 	  	
		    $.ajax({		    	
	            url: callurl+"webservices/add-memory/"+validation,
	            type: "POST",
	            data: $("#new-person-memory-form").serialize(),
	            dataType: "json",
	            success: 
	            	function(json_response){	            			            			            			            
	            		switch(json_response.code){
	            			case 201: 
	            				window.location=appurl+"person-memories/"+validation+"/"+json_response.new_memory_id;
	            			default: alert("error");	            				 	            			
	            		}	                	
	               	}//end function	                    				
			});//end ajax
		  }//end submithandler
	 });//end validate	 
  
 
});//end document ready